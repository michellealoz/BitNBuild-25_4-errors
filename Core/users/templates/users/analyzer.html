<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Text Analyser</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define the Neon Green color for easy reference in CSS */
        :root {
            --neon-green: #9ae49a;
            --neon-blue: #4A90E2; /* For contrast/primary highlights */
            --neon-green-shadow: 0 0 15px rgba(154, 228, 154, 0.5);
            --neon-blue-shadow: 0 0 15px rgba(74, 144, 226, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #000000;
            color: #E0F7FA;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }
        /* Card with subtle border and glow */
        .app-card {
            background: #0A0A0A;
            border: 1px solid #1A1A1A;
            border-radius: 20px;
            box-shadow: var(--neon-green-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .app-card-blue {
            box-shadow: var(--neon-blue-shadow);
        }

        /* Input Fields */
        .form-input {
            background: #000000;
            border: 1px solid #333333;
            color: white;
            border-radius: 12px;
            transition: all 0.3s ease;
            padding: 0.75rem 1rem;
        }
        /* Input Focus: Neon Green Border and Shadow */
        .form-input:focus {
            outline: none;
            border-color: var(--neon-green);
            box-shadow: 0 0 0 2px rgba(154, 228, 154, 0.3);
        }
        /* Primary Button: Neon Green Background and Glow */
        .btn-primary {
            background: var(--neon-green);
            color: #000000;
            border-radius: 12px;
            font-weight: 700;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(154, 228, 154, 0.4); 
        }
        /* Stronger glow and scale on hover */
        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 0 25px rgba(154, 228, 154, 0.8); 
        }
        
        /* Custom scrollbar styling for the textarea */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #333333; 
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-track {
            background: #000000;
        }

        /* Utility classes for text colors */
        .text-neon-green { color: var(--neon-green); }
        .text-neon-blue { color: var(--neon-blue); }
        .bg-neon-green { background-color: var(--neon-green); }
        .bg-neon-blue { background-color: var(--neon-blue); }
        .border-neon-green { border-color: var(--neon-green); }
        .border-neon-blue { border-color: var(--neon-blue); }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 font-sans">

    <!-- Main Container Card -->
    <div class="w-full max-w-2xl app-card p-8 space-y-6">
        <h1 class="text-3xl font-extrabold text-neon-green text-center tracking-tight">AI Text Analyzer</h1>
        <p class="text-center text-sm text-gray-400">Input your text and select an analysis type for instant insights powered by Gemini.</p>
        
        <!-- Input Section -->
        <div class="space-y-4">
            <label for="textArea" class="block text-sm font-medium text-neon-green">Text Input</label>
            <textarea id="textArea" rows="8" placeholder="Paste your article, email, or passage here..."
                class="w-full form-input"></textarea>
        </div>

        <!-- Controls Section -->
        <div class="flex flex-col sm:flex-row gap-4">
            <div class="flex-grow">
                <label for="analysisType" class="block text-sm font-medium text-neon-green mb-1">Analysis Type</label>
                <select id="analysisType"
                    class="w-full form-input appearance-none">
                    <option value="summarize">Summarize</option>
                    <option value="sentiment">Sentiment Analysis</option>
                    <option value="keywords">Keyword Extraction</option>
                    <option value="tone">Tone of Voice</option>
                </select>
            </div>
            <button id="analyzeButton" onclick="analyzeText()"
                class="sm:mt-6 w-full sm:w-auto px-6 py-3 btn-primary disabled:opacity-50 disabled:cursor-not-allowed">
                Analyze Text
            </button>
        </div>

        <!-- Result Section -->
        <div id="resultContainer" class="hidden space-y-4 pt-4">
            <h2 class="text-xl font-bold text-neon-blue border-b border-neon-blue pb-2">Analysis Result</h2>
            <!-- Result container with black background and neon border/text -->
            <div id="resultContent" class="p-4 bg-black border border-neon-green rounded-lg text-white whitespace-pre-wrap">
                <!-- Analysis result will be displayed here -->
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="hidden flex justify-center items-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-neon-green"></div>
            <p class="ml-4 text-neon-green font-medium">Analyzing...</p>
        </div>

    </div>

    <script type="module">
        // Global constants for Firebase/Auth (MUST be used if available)
        const __app_id = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const __firebase_config = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
        const __initial_auth_token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const MODEL_NAME = "gemini-2.5-flash-preview-05-20";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=`;
        
        const textArea = document.getElementById('textArea');
        const analyzeButton = document.getElementById('analyzeButton');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const resultContainer = document.getElementById('resultContainer');
        const resultContent = document.getElementById('resultContent');

        // Function to set UI state (loading/enabled)
        function setUIState(isLoading) {
            analyzeButton.disabled = isLoading;
            textArea.disabled = isLoading;
            loadingSpinner.classList.toggle('hidden', !isLoading);
            analyzeButton.textContent = isLoading ? 'Processing...' : 'Analyze Text';
            if (isLoading) {
                resultContainer.classList.add('hidden');
                resultContent.textContent = '';
            }
        }

        // Main analysis function
        window.analyzeText = async function() {
            const userText = textArea.value.trim();
            if (!userText) {
                resultContent.textContent = 'Please enter some text to analyze.';
                resultContainer.classList.remove('hidden');
                return;
            }

            setUIState(true);

            const analysisType = document.getElementById('analysisType').value;
            let systemPrompt = "";

            switch(analysisType) {
                case 'summarize':
                    systemPrompt = "You are an expert summarization bot. Provide a concise, neutral, and accurate summary of the provided text in 3-5 sentences.";
                    break;
                case 'sentiment':
                    systemPrompt = "You are an expert sentiment analyst. Analyze the provided text and determine the overall sentiment (Positive, Negative, or Neutral). Provide a clear title for the result and a one-paragraph explanation for your rating.";
                    break;
                case 'keywords':
                    systemPrompt = "You are an expert keyword extraction tool. Identify the 5 most important keywords or phrases from the text and list them as a bulleted markdown list.";
                    break;
                case 'tone':
                    systemPrompt = "You are a professional communication expert. Determine the primary tone of voice (e.g., Formal, Casual, Urgent, Reflective) used in the text and provide a brief justification.";
                    break;
                default:
                    systemPrompt = "Analyze the user's text and provide a concise, high-quality analysis based on the selected type.";
            }

            const userQuery = `Text to analyze: "${userText}"`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let responseText = "Analysis failed. Please try again.";
            let attempt = 0;
            const maxRetries = 3;

            while (attempt < maxRetries) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        responseText = candidate.content.parts[0].text;
                        break; // Success, break the retry loop
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    attempt++;
                    if (attempt < maxRetries) {
                        const delay = Math.pow(2, attempt) * 1000; // Exponential backoff (2s, 4s, 8s)
                        await new Promise(resolve => setTimeout(resolve, delay));
                        responseText = `Analysis failed after multiple retries (${maxRetries}). Please check the console for details.`;
                    }
                }
            }

            setUIState(false);
            resultContent.textContent = responseText;
            resultContainer.classList.remove('hidden');
        }
    </script>
</body>
</html>
